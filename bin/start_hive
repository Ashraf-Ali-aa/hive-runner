#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path("../../lib", __FILE__)

require 'socket'
require 'hive/daemon_helper'

# Initialise
Hive::DaemonHelper.instantiate_controllers
Hive::DaemonHelper.check_workers

comm = TCPServer.open(9999)
Signal.trap("INFO") do
  client = comm.accept
  Hive::DaemonHelper.controllers.each do |c|
    client.puts "Using #{c.class.name.split('::').last.downcase} controller"
  end
  #client.puts "Number of workers: #{workers.length}"
  #if workers.length > 0
  #  client.puts "Workers:"
  #  workers.each do |w|
  #    client.puts " - #{w[:type]} worker [pid #{w[:pid]}]"
  #  end
  #end
  client.close
end

# Execution loop
Hive::DaemonHelper.run
